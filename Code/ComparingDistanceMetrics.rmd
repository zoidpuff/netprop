---
title: "Comparing distance metrics"
output: html_document
---

```{r setup, include=FALSE}
netPropPath <- "/home/gummi/netprop"
load("/home/gummi/netprop/masterRes.rdata")
library(ggplot2)
library(kableExtra)
library(dplyr)
library(plotly)
library(kableExtra)
source(paste0(netPropPath, '/Code/NetPropFuncs.R'))
diseaseMapping <- read.csv("/home/gummi/netprop/data/phenotypeMapping.csv")

knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE) 

```


```{r include=FALSE} 

distFuncsT <- c("euclidean", "manhattan", "cosine", "cosineSharp2",
                "pearsonDist", "spearmanDist", "kendallDist")

varCuttOffsT <- c("0","0.25", "0.5", "0.75","0Center")

plotDensityGridTransposed <- function(distFuncs, varCuttOffs, normMethod, dataset, masterRes) {
    listOfPlots <- list()
    for(cuttoff in varCuttOffs) {
        if(cuttoff == "0Center") {
            cuttoff <- "0"
            center <- "TRUE"
        } else {
            center <- "FALSE"
        }
        for(dist in distFuncs) {
            plots <- generatePlotsFromDistCompareResults( masterRes[[dataset]][[normMethod]][[cuttoff]][[center]][["FALSE"]][[dist]] )
            if(center == "TRUE") {
                cuttoffLab <- paste0(cuttoff," Centered")
            } else {
                cuttoffLab <- cuttoff
            }
            listOfPlots[[paste(cuttoffLab,dist)]] <- plots[[1]] + 
            theme(axis.title.x=element_blank(),
                  axis.text.y=element_blank(),
                  axis.ticks.y=element_blank()) 
            if(dist == distFuncs[1]) {
                listOfPlots[[paste(cuttoffLab,dist)]] <- listOfPlots[[paste(cuttoffLab,dist)]] + ylab(cuttoffLab)
            } else {
                listOfPlots[[paste(cuttoffLab,dist)]] <- listOfPlots[[paste(cuttoffLab,dist)]] + ylab("")
            }
            if(cuttoffLab == varCuttOffs[1]) {
                listOfPlots[[paste(cuttoffLab,dist)]] <- listOfPlots[[paste(cuttoffLab,dist)]] + ggtitle(dist)
            } else {
                listOfPlots[[paste(cuttoffLab,dist)]] <- listOfPlots[[paste(cuttoffLab,dist)]] + ggtitle("") }
        }
    }

    plotT <- cowplot::plot_grid(plotlist = listOfPlots, ncol = length(distFuncs), byrow = TRUE)
    return(plotT)
}
plotDensityGridTransposed <- function(distFuncs, varCuttOffs, normMethod, dataset, masterRes) {
    listOfPlots <- list()
    x_ranges <- list()
    for(cuttoff in varCuttOffs) {
        if(cuttoff == "0Center") {
            cuttoff <- "0"
            center <- "TRUE"
        } else {
            center <- "FALSE"
        }
        for(dist in distFuncs) {
            plots <- generatePlotsFromDistCompareResults( masterRes[[dataset]][[normMethod]][[cuttoff]][[center]][["FALSE"]][[dist]] )
            if(center == "TRUE") {
                cuttoffLab <- paste0(cuttoff," Centered")
            } else {
                cuttoffLab <- cuttoff
            }
            listOfPlots[[paste(cuttoffLab,dist)]] <- plots[[1]] + 
            theme(axis.title.x=element_blank(),
                  axis.text.y=element_blank(),
                  axis.ticks.y=element_blank()) 
            if(dist == distFuncs[1]) {
                listOfPlots[[paste(cuttoffLab,dist)]] <- listOfPlots[[paste(cuttoffLab,dist)]] + ylab(cuttoffLab)
            } else {
                listOfPlots[[paste(cuttoffLab,dist)]] <- listOfPlots[[paste(cuttoffLab,dist)]] + ylab("")
            }
            if(cuttoffLab == varCuttOffs[1]) {
                listOfPlots[[paste(cuttoffLab,dist)]] <- listOfPlots[[paste(cuttoffLab,dist)]] + ggtitle(dist)
            } else {
                listOfPlots[[paste(cuttoffLab,dist)]] <- listOfPlots[[paste(cuttoffLab,dist)]] + ggtitle("") }
            
            if(cuttoffLab != "0 Centered") {
                  x_ranges[[cuttoffLab]][[dist]] <- layer_scales(plots[[1]])$x$range$range
            }
            # Store the x range of each plot

        }
    }

    # Loop over the distance functions to find the minimum and maximum x for each function
    for(dist in distFuncs) {
        x_min <- min(unlist(lapply(x_ranges, function(x) x[[dist]][1])))
        x_max <- max(unlist(lapply(x_ranges, function(x) x[[dist]][2])))

        # Loop over the plots again to set the x limits for each distance function
        for(cuttoff in varCuttOffs) {
            if(cuttoff == "0Center") {
                
            } else {
                cuttoffLab <- cuttoff
                listOfPlots[[paste(cuttoffLab,dist)]] <- listOfPlots[[paste(cuttoffLab,dist)]] + xlim(x_min, x_max)
            }
            
        }
    }

    plotT <- cowplot::plot_grid(plotlist = listOfPlots, ncol = length(distFuncs), byrow = TRUE)
    return(plotT)
}

```


## Node Degree Relationship


```{r, echo=FALSE,out.width="49%", out.height="20%",fig.cap="",fig.show='hold',fig.align='center'}
knitr::include_graphics(c("/home/gummi/netprop/image4.png","/home/gummi/netprop/image5.png"))
``` 

---

![](/home/gummi/netprop/image6.png)

---

## Overall Scores, All Traits {.tabset .tabset-pills}

### No normalization

```{r fig.height=15, fig.width=10, warning=FALSE}

plotDensityGridTransposed(distFuncsT, varCuttOffsT, "noNorm", "AllTraitsOverallScores", masterRes)

```

### Eigen Centrality normalization

```{r fig.height=15, fig.width=10}


plotDensityGrid(distFuncsT, varCuttOffsT, "ECnorm", "AllTraitsOverallScores", masterRes)


```

### Log Ratio Eigen Centrality normalization

```{r fig.height=15, fig.width=10}


plotDensityGrid(distFuncsT, varCuttOffsT, "ECnormLog", "AllTraitsOverallScores", masterRes)


```

### Permutation Testing normalization

```{r fig.height=15, fig.width=10}


plotDensityGrid(distFuncsT, varCuttOffsT, "permuteNormDegree", "AllTraitsOverallScores", masterRes)


```


## Overall Scores, EFO Traits Only {.tabset .tabset-pills}

### No normalization

```{r fig.height=15, fig.width=10, warning=FALSE}

plotDensityGrid(distFuncsT, varCuttOffsT, "noNorm", "EFOTraitsOverallScores", masterRes)

```

### Eigen Centrality normalization

```{r fig.height=15, fig.width=10}


plotDensityGrid(distFuncsT, varCuttOffsT, "ECnorm", "EFOTraitsOverallScores", masterRes)


```

### Log Ratio Eigen Centrality normalization

```{r fig.height=15, fig.width=10}


plotDensityGrid(distFuncsT, varCuttOffsT, "ECnormLog", "EFOTraitsOverallScores", masterRes)


```

### Permutation Testing normalization

```{r fig.height=15, fig.width=10}


plotDensityGrid(distFuncsT, varCuttOffsT, "permuteNormDegree", "EFOTraitsOverallScores", masterRes)


```



## Orphanet Clinvar Clingen scores {.tabset .tabset-pills}

### No normalization

```{r fig.height=15, fig.width=10, warning=FALSE}

plotDensityGrid(distFuncsT, varCuttOffsT, "noNorm", "RareDiseasesOrphaEvaClingenScores", masterRes)

```

### Eigen Centrality normalization

```{r fig.height=15, fig.width=10}


plotDensityGrid(distFuncsT, varCuttOffsT, "ECnorm", "RareDiseasesOrphaEvaClingenScores", masterRes)


```

### Log Ratio Eigen Centrality normalization

```{r fig.height=15, fig.width=10}


plotDensityGrid(distFuncsT, varCuttOffsT, "ECnormLog", "RareDiseasesOrphaEvaClingenScores", masterRes)


```

### Permutation Testing normalization

```{r fig.height=15, fig.width=10}


plotDensityGrid(distFuncsT, varCuttOffsT, "permuteNormDegree", "RareDiseasesOrphaEvaClingenScores", masterRes)


```

---

## UMAPs {.tabset .tabset-pills}


### Euclidean
```{r fig.height=8, fig.width=10, warning=FALSE}

plots <- generatePlotsFromDistCompareResults(masterRes[["AllTraitsOverallScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["euclidean"]],diseaseMapping) 

ggplotly(plots[["Plot_Leiden_UMAP"]])


```


### Manhattan
```{r fig.height=8, fig.width=10, warning=FALSE}

plots <- generatePlotsFromDistCompareResults(masterRes[["AllTraitsOverallScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["manhattan"]],diseaseMapping) 

ggplotly(plots[["Plot_Leiden_UMAP"]])


```

### Cosine
```{r fig.height=8, fig.width=10, warning=FALSE}

plots <- generatePlotsFromDistCompareResults(masterRes[["AllTraitsOverallScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["cosine"]],diseaseMapping)

ggplotly(plots[["Plot_Leiden_UMAP"]])


```


### Kendall

```{r fig.height=8, fig.width=10, warning=FALSE}

plots <- generatePlotsFromDistCompareResults(masterRes[["AllTraitsOverallScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["kendall"]],diseaseMapping)

ggplotly(plots[["Plot_Leiden_UMAP"]])


```


## Cluster Legend {.tabset .tabset-pills}

### Euclidean
    
```{r include=TRUE, warning=FALSE}

df <- masterRes[["AllTraitsOverallScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["euclidean"]][["legendDF_Leiden"]][,c("Clusters","Counts","Entropy","Ancestors")]

kable(df, digits = 2, format = "html", row.names = TRUE) %>%
  kable_styling(bootstrap_options = c("striped"),
                full_width = T,
                font_size = 15) %>%
   scroll_box(height = "300px")

```


### Manhattan
```{r include=TRUE, warning=FALSE}

df <- masterRes[["AllTraitsOverallScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["manhattan"]][["legendDF_Leiden"]][,c("Clusters","Counts","Entropy","Ancestors")]

kable(df, digits = 2, format = "html", row.names = TRUE) %>%
  kable_styling(bootstrap_options = c("striped"),
                full_width = T,
                font_size = 15) %>%
   scroll_box(height = "300px")

```

### Cosine
```{r include=TRUE, warning=FALSE}

df <- masterRes[["AllTraitsOverallScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["cosine"]][["legendDF_Leiden"]][,c("Clusters","Counts","Entropy","Ancestors")]

kable(df, digits = 2, format = "html", row.names = TRUE) %>%
  kable_styling(bootstrap_options = c("striped"),
                full_width = T,
                font_size = 15) %>%
   scroll_box(height = "300px")

```

### Kendall
```{r include=TRUE, warning=FALSE}

df <- masterRes[["AllTraitsOverallScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["kendall"]][["legendDF_Leiden"]][,c("Clusters","Counts","Entropy","Ancestors")]

kable(df, digits = 2, format = "html", row.names = TRUE) %>%
  kable_styling(bootstrap_options = c("striped"),
                full_width = T,
                font_size = 15) %>%
   scroll_box(height = "300px")

```



## MDS {.tabset .tabset-pills}


### Euclidean
```{r fig.height=8, fig.width=10, warning=FALSE}

plots <- generatePlotsFromDistCompareResults(masterRes[["AllTraitsOverallScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["euclidean"]],diseaseMapping) 

ggplotly(plots[["Plot_Leiden_cMDS"]])


```


### Manhattan
```{r fig.height=8, fig.width=10, warning=FALSE}

plots <- generatePlotsFromDistCompareResults(masterRes[["AllTraitsOverallScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["manhattan"]],diseaseMapping) 

ggplotly(plots[["Plot_Leiden_cMDS"]])


```

### Cosine
```{r fig.height=8, fig.width=10, warning=FALSE}

plots <- generatePlotsFromDistCompareResults(masterRes[["AllTraitsOverallScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["cosine"]],diseaseMapping)

ggplotly(plots[["Plot_Leiden_cMDS"]])


```


### Kendall

```{r fig.height=8, fig.width=10, warning=FALSE}

plots <- generatePlotsFromDistCompareResults(masterRes[["AllTraitsOverallScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["kendall"]],diseaseMapping)

ggplotly(plots[["Plot_Leiden_cMDS"]])


```


---

## EFO only, Overall Scores

## UMAPs {.tabset .tabset-pills}


### Euclidean
```{r fig.height=8, fig.width=10, warning=FALSE}

plots <- generatePlotsFromDistCompareResults(masterRes[["EFOTraitsOverallScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["euclidean"]],diseaseMapping) 

ggplotly(plots[["Plot_Leiden_UMAP"]])


```


### Manhattan
```{r fig.height=8, fig.width=10, warning=FALSE}

plots <- generatePlotsFromDistCompareResults(masterRes[["EFOTraitsOverallScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["manhattan"]],diseaseMapping) 

ggplotly(plots[["Plot_Leiden_UMAP"]])


```

### Cosine
```{r fig.height=8, fig.width=10, warning=FALSE}

plots <- generatePlotsFromDistCompareResults(masterRes[["EFOTraitsOverallScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["cosine"]],diseaseMapping)

ggplotly(plots[["Plot_Leiden_UMAP"]])


```


### Kendall

```{r fig.height=8, fig.width=10, warning=FALSE}

plots <- generatePlotsFromDistCompareResults(masterRes[["EFOTraitsOverallScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["kendall"]],diseaseMapping)

ggplotly(plots[["Plot_Leiden_UMAP"]])


```



## Cluster Legend {.tabset .tabset-pills}

### Euclidean
    
```{r include=TRUE, warning=FALSE}

df <- masterRes[["EFOTraitsOverallScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["euclidean"]][["legendDF_Leiden"]][,c("Clusters","Counts","Entropy","Ancestors")]

kable(df, digits = 2, format = "html", row.names = TRUE) %>%
  kable_styling(bootstrap_options = c("striped"),
                full_width = T,
                font_size = 15) %>%
   scroll_box(height = "300px")

```


### Manhattan
```{r include=TRUE, warning=FALSE}

df <- masterRes[["EFOTraitsOverallScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["manhattan"]][["legendDF_Leiden"]][,c("Clusters","Counts","Entropy","Ancestors")]

kable(df, digits = 2, format = "html", row.names = TRUE) %>%
  kable_styling(bootstrap_options = c("striped"),
                full_width = T,
                font_size = 15) %>%
   scroll_box(height = "300px")

```

### Cosine
```{r include=TRUE, warning=FALSE}

df <- masterRes[["EFOTraitsOverallScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["cosine"]][["legendDF_Leiden"]][,c("Clusters","Counts","Entropy","Ancestors")]

kable(df, digits = 2, format = "html", row.names = TRUE) %>%
  kable_styling(bootstrap_options = c("striped"),
                full_width = T,
                font_size = 15) %>%
   scroll_box(height = "300px")

```

### Kendall
```{r include=TRUE, warning=FALSE}

df <- masterRes[["EFOTraitsOverallScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["kendall"]][["legendDF_Leiden"]][,c("Clusters","Counts","Entropy","Ancestors")]

kable(df, digits = 2, format = "html", row.names = TRUE) %>%
  kable_styling(bootstrap_options = c("striped"),
                full_width = T,
                font_size = 15) %>%
   scroll_box(height = "300px")

```



## MDS {.tabset .tabset-pills}


### Euclidean
```{r fig.height=8, fig.width=10, warning=FALSE}

plots <- generatePlotsFromDistCompareResults(masterRes[["EFOTraitsOverallScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["euclidean"]],diseaseMapping) 

ggplotly(plots[["Plot_Leiden_cMDS"]])


```


### Manhattan
```{r fig.height=8, fig.width=10, warning=FALSE}

plots <- generatePlotsFromDistCompareResults(masterRes[["EFOTraitsOverallScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["manhattan"]],diseaseMapping) 

ggplotly(plots[["Plot_Leiden_cMDS"]])


```

### Cosine
```{r fig.height=8, fig.width=10, warning=FALSE}

plots <- generatePlotsFromDistCompareResults(masterRes[["EFOTraitsOverallScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["cosine"]],diseaseMapping)

ggplotly(plots[["Plot_Leiden_cMDS"]])


```


### Kendall

```{r fig.height=8, fig.width=10, warning=FALSE}

plots <- generatePlotsFromDistCompareResults(masterRes[["EFOTraitsOverallScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["kendall"]],diseaseMapping)

ggplotly(plots[["Plot_Leiden_cMDS"]])


```

---

## Rare Traits, Individual Dataset Scores

## UMAPs {.tabset .tabset-pills}


### Euclidean
```{r fig.height=8, fig.width=10, warning=FALSE}

plots <- generatePlotsFromDistCompareResults(masterRes[["RareDiseasesOrphaEvaClingenScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["euclidean"]],diseaseMapping) 

ggplotly(plots[["Plot_Leiden_UMAP"]])


```


### Manhattan
```{r fig.height=8, fig.width=10, warning=FALSE}

plots <- generatePlotsFromDistCompareResults(masterRes[["RareDiseasesOrphaEvaClingenScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["manhattan"]],diseaseMapping) 

ggplotly(plots[["Plot_Leiden_UMAP"]])


```

### Cosine
```{r fig.height=8, fig.width=10, warning=FALSE}

plots <- generatePlotsFromDistCompareResults(masterRes[["RareDiseasesOrphaEvaClingenScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["cosine"]],diseaseMapping)

ggplotly(plots[["Plot_Leiden_UMAP"]])


```


### Kendall

```{r fig.height=8, fig.width=10, warning=FALSE}

plots <- generatePlotsFromDistCompareResults(masterRes[["RareDiseasesOrphaEvaClingenScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["kendall"]],diseaseMapping)

ggplotly(plots[["Plot_Leiden_UMAP"]])


```


## Cluster Legend {.tabset .tabset-pills}

### Euclidean
    
```{r include=TRUE, warning=FALSE}

df <- masterRes[["RareDiseasesOrphaEvaClingenScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["euclidean"]][["legendDF_Leiden"]][,c("Clusters","Counts","Entropy","Ancestors")]

kable(df, digits = 2, format = "html", row.names = TRUE) %>%
  kable_styling(bootstrap_options = c("striped"),
                full_width = T,
                font_size = 15) %>%
   scroll_box(height = "300px")

```


### Manhattan
```{r include=TRUE, warning=FALSE}

df <- masterRes[["RareDiseasesOrphaEvaClingenScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["manhattan"]][["legendDF_Leiden"]][,c("Clusters","Counts","Entropy","Ancestors")]

kable(df, digits = 2, format = "html", row.names = TRUE) %>%
  kable_styling(bootstrap_options = c("striped"),
                full_width = T,
                font_size = 15) %>%
   scroll_box(height = "300px")

```

### Cosine
```{r include=TRUE, warning=FALSE}

df <- masterRes[["RareDiseasesOrphaEvaClingenScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["cosine"]][["legendDF_Leiden"]][,c("Clusters","Counts","Entropy","Ancestors")]

kable(df, digits = 2, format = "html", row.names = TRUE) %>%
  kable_styling(bootstrap_options = c("striped"),
                full_width = T,
                font_size = 15) %>%
   scroll_box(height = "300px")

```

### Kendall
```{r include=TRUE, warning=FALSE}

df <- masterRes[["RareDiseasesOrphaEvaClingenScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["kendall"]][["legendDF_Leiden"]][,c("Clusters","Counts","Entropy","Ancestors")]

kable(df, digits = 2, format = "html", row.names = TRUE) %>%
  kable_styling(bootstrap_options = c("striped"),
                full_width = T,
                font_size = 15) %>%
   scroll_box(height = "300px")

```



## MDS {.tabset .tabset-pills}


### Euclidean
```{r fig.height=8, fig.width=10, warning=FALSE}

plots <- generatePlotsFromDistCompareResults(masterRes[["RareDiseasesOrphaEvaClingenScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["euclidean"]],diseaseMapping) 

ggplotly(plots[["Plot_Leiden_cMDS"]])


```


### Manhattan
```{r fig.height=8, fig.width=10, warning=FALSE}

plots <- generatePlotsFromDistCompareResults(masterRes[["RareDiseasesOrphaEvaClingenScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["manhattan"]],diseaseMapping) 

ggplotly(plots[["Plot_Leiden_cMDS"]])

sure
```

### Cosine
```{r fig.height=8, fig.width=10, warning=FALSE}

plots <- generatePlotsFromDistCompareResults(masterRes[["RareDiseasesOrphaEvaClingenScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["cosine"]],diseaseMapping)

ggplotly(plots[["Plot_Leiden_cMDS"]])


```


### Kendall

```{r fig.height=8, fig.width=10, warning=FALSE}

plots <- generatePlotsFromDistCompareResults(masterRes[["RareDiseasesOrphaEvaClingenScores"]][["noNorm"]][["0"]][["FALSE"]][["FALSE"]][["kendall"]],diseaseMapping)

ggplotly(plots[["Plot_Leiden_cMDS"]])


```