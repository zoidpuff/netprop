---
title: "Comparing distance metrics"
output: html_document
---

```{r setup, include=FALSE}
netPropPath <- "/home/gummi/netprop"
load("/home/gummi/netprop/results/netpropDistanceResRAREcommon_assocRareGWASRelatedSet_noNorm_kendall.rdata")
library(ggplot2)
library(kableExtra)
library(dplyr)
library(plotly)
library(kableExtra)
source(paste0(netPropPath, '/Code/NetPropFuncs.R'))
load("/home/gummi/netprop/data/diseasesNew.rdata")
diseaseMapping <- diseaseDF

knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE) 

```


```{r include=FALSE} 

names(res)
  


```

```{r include=TRUE} 

summaries <- c("summaryRandom",
                "summaryRelated_across",
                "summaryRelated_ot_genetics_portal",
                "summaryRelated_eva, orphanet",
                "summaryRelated_randomot_genetics_portal",
                "summaryRelated_randomeva, orphanet")

summaryList <- res[summaries]


summaryList

```


```{r include=TRUE} 
densities <- c("densityEstRand",
    "densityEstRel_across",
    "densityEstRel_ot_genetics_portal",
    "densityEstRel_eva, orphanet",
    "densityEstRel_randomot_genetics_portal",
    "densityEstRel_randomeva, orphanet")

densitiesList <- res[densities]

ggplot(data.frame("x" = densitiesList[["densityEstRand"]]$x, "y" = densitiesList[["densityEstRand"]]$y), aes(x = x, y = y)) +
            geom_line() +
            geom_line(data = data.frame("x" = densitiesList[["densityEstRel_across"]]$x, "y" = densitiesList[["densityEstRel_across"]]$y), aes(x = x, y = y), color = "red") +
            geom_line(data = data.frame("x" = densitiesList[["densityEstRel_ot_genetics_portal"]]$x, "y" = densitiesList[["densityEstRel_ot_genetics_portal"]]$y), aes(x = x, y = y), color = "blue") +
            geom_line(data = data.frame("x" = densitiesList[["densityEstRel_eva, orphanet"]]$x, "y" = densitiesList[["densityEstRel_eva, orphanet"]]$y), aes(x = x, y = y), color = "green") +
            geom_line(data = data.frame("x" = densitiesList[["densityEstRel_randomot_genetics_portal"]]$x, "y" = densitiesList[["densityEstRel_randomot_genetics_portal"]]$y), aes(x = x, y = y), color = "purple") +
            geom_line(data = data.frame("x" = densitiesList[["densityEstRel_randomeva, orphanet"]]$x, "y" = densitiesList[["densityEstRel_randomeva, orphanet"]]$y), aes(x = x, y = y), color = "orange") +
            theme_classic() +
            labs(title = "Density plot of related and random diseases",
                x = "Distance",
                y = "Density") +
                # Add a legend
                scale_color_manual(values = c("black", "red", "blue", "green", "purple", "orange"),
                labels = c("Random", "Related across", "Related ot genetics portal", "Related eva, orphanet", "Related randomot genetics portal", "Related randomeva, orphanet")) +
                theme(legend.position = "bottom")

```

```{r include=TRUE}

vectors <- c(
    "related_across",
    "related_ot_genetics_portal",
    "related_eva, orphanet",
    "related_randomot_genetics_portal",
    "related_randomeva, orphanet")

# Add the vectors together into a dataframe, including a label column

vectorList <- lapply(vectors, function(x) {
    data.frame("value" = res[[x]], "label" = x)
})

vectorDF <- do.call(rbind, vectorList)

vectorDF$label <- factor(vectorDF$label, levels = vectors)

# Filter out any value that is 1 or more

vectorDF <- vectorDF[vectorDF$value < 1,]

# Do a linear model

lmRes <- lm(value ~ label, data = vectorDF)

# Get the summary of the linear model

summary(lmRes)

```

```{r include=TRUE}

# Plot the vecorts as a boxplot

ggplot(vectorDF, aes(x = label, y = value, fill = label)) +
    geom_boxplot() +
    theme_classic() +
    labs(title = "Boxplot of related diseases",
        x = "Disease set",
        y = "Distance") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
    # Add t-tests with ggpubr
    ggpubr::stat_compare_means(method = "t.test", comparisons = list(c("related_randomot_genetics_portal", "related_across"),
                                                                    c("related_randomot_genetics_portal", "related_ot_genetics_portal"),
                                                                    c("related_randomot_genetics_portal", "related_eva, orphanet"),
                                                                    c("related_randomot_genetics_portal", "related_randomeva, orphanet")),
                                                                    label = "p.format") 
```


```{r include=TRUE}

# get some plots with generatePlotsFromDistCompareResults

plots <- generatePlotsFromDistCompareResults(res,diseaseMapping,skipDensity = TRUE) 
ggplotly(plots[["Plot_Leiden_UMAP"]])
```


```{r include=TRUE}

# get some plots with generatePlotsFromDistCompareResults

plots <- generatePlotsFromDistCompareResults(res,diseaseMapping,skipDensity = TRUE) 
ggplotly(plots[["Plot_Leiden_cMDS"]])
```