---
title: "Comparing distance metrics"
output: html_document
---

```{r setup, include=FALSE}
netPropPath <- "/home/gummi/netprop"
load("/home/gummi/netprop/netpropDistanceResRAREcommon_assocRareGWASRelatedSet_ECnormLog_kendall.rdata")
library(ggplot2)
library(kableExtra)
library(dplyr)
library(plotly)
library(kableExtra)
source(paste0(netPropPath, '/Code/NetPropFuncs.R'))
load("/home/gummi/netprop/data/diseasesNew.rdata")
diseaseMapping <- diseaseDF

knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE) 

```


```{r include=FALSE} 

names(res)
  


```

```{r include=TRUE} 

summaries <- c("summaryRandom",
                "summaryRelated_across",
                "summaryRelated_ot_genetics_portal",
                "summaryRelated_eva, orphanet",
                "summaryRelated_randomot_genetics_portal",
                "summaryRelated_randomeva, orphanet")

summaryList <- res[summaries]


summaryList

```


```{r include=TRUE} 
densities <- c("densityEstRand",
    "densityEstRel_across",
    "densityEstRel_ot_genetics_portal",
    "densityEstRel_eva, orphanet",
    "densityEstRel_randomot_genetics_portal",
    "densityEstRel_randomeva, orphanet")

densitiesList <- res[densities]

ggplot(data.frame("x" = densitiesList[["densityEstRand"]]$x, "y" = densitiesList[["densityEstRand"]]$y), aes(x = x, y = y)) +
            geom_line() +
            geom_line(data = data.frame("x" = densitiesList[["densityEstRel_across"]]$x, "y" = densitiesList[["densityEstRel_across"]]$y), aes(x = x, y = y), color = "red") +
            geom_line(data = data.frame("x" = densitiesList[["densityEstRel_ot_genetics_portal"]]$x, "y" = densitiesList[["densityEstRel_ot_genetics_portal"]]$y), aes(x = x, y = y), color = "blue") +
            geom_line(data = data.frame("x" = densitiesList[["densityEstRel_eva, orphanet"]]$x, "y" = densitiesList[["densityEstRel_eva, orphanet"]]$y), aes(x = x, y = y), color = "green") +
            geom_line(data = data.frame("x" = densitiesList[["densityEstRel_randomot_genetics_portal"]]$x, "y" = densitiesList[["densityEstRel_randomot_genetics_portal"]]$y), aes(x = x, y = y), color = "purple") +
            geom_line(data = data.frame("x" = densitiesList[["densityEstRel_randomeva, orphanet"]]$x, "y" = densitiesList[["densityEstRel_randomeva, orphanet"]]$y), aes(x = x, y = y), color = "orange") +
            theme_classic() +
            labs(title = "Density plot of related and random diseases",
                x = "Distance",
                y = "Density") +
                # Add a legend
                scale_color_manual(values = c("black", "red", "blue", "green", "purple", "orange"),
                labels = c("Random", "Related across", "Related ot genetics portal", "Related eva, orphanet", "Related randomot genetics portal", "Related randomeva, orphanet")) +
                theme(legend.position = "bottom")

```

```{r include=TRUE}

vectors <- c(
    "randomVec",
    "related_across",
    "related_Relacross",
    "related_ot_genetics_portal",
    "related_eva, orphanet")

# Add the vectors together into a dataframe, including a label column

vectorList <- lapply(vectors, function(x) {
    data.frame("value" = res[[x]], "label" = x)
})

vectorDF <- do.call(rbind, vectorList)

vectorDF$label <- factor(vectorDF$label, levels = vectors,
                                         labels = c("Random Trait Pairs",
                                                    "Same trait, Across Sources",
                                                    "Related Traits, Across Sources",
                                                    "Related Traits, GWAS Source",
                                                    "Related Traits, Curated DB Source"
                                                    ))
                                                    
# Filter out any value that is 1 or more

vectorDF <- vectorDF[vectorDF$value < 1,]

# Do a linear model

lmRes <- lm(value ~ label, data = vectorDF)

# Get the summary of the linear model

summary(lmRes)

```

```{r include=TRUE}

# Plot the vecorts as a boxplot

plot <- ggplot(vectorDF, aes(x = label, y = value, fill = label)) +
    geom_boxplot() +
    theme_classic() +
    labs(
        x = "",
        y = "Kendall Correlation Coeffcient") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
    ggsci::scale_fill_npg() +
    ggpubr::stat_compare_means(method = "t.test", comparisons = list(c("Random Trait Pairs", "Same trait, Across Sources"),
                                                                    c("Random Trait Pairs", "Related Traits, Across Sources"),
                                                                    c("Same trait, Across Sources", "Related Traits, Across Sources"),
                                                                    c("Same trait, Across Sources", "Related Traits, GWAS Source"),
                                                                    c("Same trait, Across Sources", "Related Traits, Curated DB Source")),
                                                                    label = "p.format") +
                               # Remove legend title
    theme(legend.title = element_blank())

# save thhe plot
plot
ggsave("/home/gummi/netprop/results/boxplot.png", plot, width = 7, height = 6)

```
```{r include=TRUE}

# get some plots with generatePlotsFromDistCompareResults
res[["pairDF_Leiden_UMAP"]] <- filter(res[["pairDF_Leiden_UMAP"]], pairName == "across")
plots <- generatePlotsFromDistCompareResults(res,diseaseMapping,skipDensity = TRUE) 


ggplotly(plots[["Plot_Leiden_UMAP"]])
```


```{r include=TRUE}

# get some plots with generatePlotsFromDistCompareResults

res[["pairDF_Leiden_cMDS"]] <- filter(res[["pairDF_Leiden_cMDS"]], pairName == "across")
plots <- generatePlotsFromDistCompareResults(res,diseaseMapping,skipDensity = TRUE) 
ggplotly(plots[["Plot_Leiden_cMDS"]])
```